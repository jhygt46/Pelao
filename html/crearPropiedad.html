<script>
    initMap();
    function initMap() {

        var position = { lat: -25.344, lng: 131.036 };
        var map = new google.maps.Map(document.getElementById("map"), {
            zoom: 4,
            center: position,
        });
        var marker = new google.maps.Marker({
            position: position,
            map: map,
            draggable: true
        });
        google.maps.event.addListener(marker, 'dragend', function (evt) {
            $('#lat').val(evt.latLng.lat().toFixed(6));
            $('#lng').val(evt.latLng.lng().toFixed(6));
            map.panTo(evt.latLng);
        });

        marker.addListener("click", () => {
            //map.setZoom(8);
            //map.setCenter(marker.getPosition());
        });

        //map.controls[google.maps.ControlPosition.TOP_RIGHT].push(card);

        const autocomplete = new google.maps.places.Autocomplete(document.getElementById("direccion"), {});

        // Set initial restriction to the greater list of countries.
        autocomplete.setComponentRestrictions({
            country: ["cl"],
        });

        const southwest = { lat: 5.6108, lng: 136.589326 };
        const northeast = { lat: 61.179287, lng: 2.64325 };
        const newBounds = new google.maps.LatLngBounds(southwest, northeast);

        autocomplete.setBounds(newBounds);

        const infowindow = new google.maps.InfoWindow();
        const infowindowContent = document.getElementById("infowindow-content");

        infowindow.setContent(infowindowContent);

        autocomplete.addListener("place_changed", () => {
            
            infowindow.close();
            marker.setVisible(false);

            const place = autocomplete.getPlace();

            if (!place.geometry || !place.geometry.location) {
            // User entered the name of a Place that was not suggested and
            // pressed the Enter key, or the Place Details request failed.
            window.alert("No details available for input: '" + place.name + "'");
            return;
            }

            // If the place has a geometry, then present it on a map.
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17); // Why 17? Because it looks good.
            }

            $('#lat').val(place.geometry.location.lat());
            $('#lng').val(place.geometry.location.lng());

            marker.setPosition(place.geometry.location);
            marker.setVisible(true);
            
            let address = "";
            if (place.address_components) {
            address = [
                (place.address_components[0] &&
                place.address_components[0].short_name) ||
                "",
                (place.address_components[1] &&
                place.address_components[1].short_name) ||
                "",
                (place.address_components[2] &&
                place.address_components[2].short_name) ||
                "",
            ].join(" ");
            }

            infowindowContent.children["place-icon"].src = place.icon;
            infowindowContent.children["place-name"].textContent = place.name;
            infowindowContent.children["place-address"].textContent = address;
            infowindow.open(map, marker);
            
        });

        
    }
</script>
<div class="mt">
    <h1>{{.Titulo}}</h1>
    <ul class="clearfix valign">
        <li class="back" onclick="backurl()"></li>
        <li class="back" onclick="backurl()"></li>
    </ul>
</div>
<hr>
<div class="i">
    <div class="fc" id="info-0">
        <div class="fct">
            <h1>{{.SubTitulo}}</h1>
            <h2>{{.SubTitulo2}}</h2>
            <ul class="clearfix valign">
                <li class="back" onclick="backurl()"></li>
                <li class="back" onclick="backurl()"></li>
            </ul>
        </div>
        <form action="" method="post" class="basic-grey">
            <fieldset>
                <input id="id" type="hidden" value="{{.FormId}}" />
                <input id="accion" type="hidden" value="{{.FormAccion}}" />
                <label>
                    <span>Nombre:</span>
                    <input id="nombre" type="text" value="{{.FormNombre}}" require="" placeholder="" />
                    <div class="mensaje"></div>
                </label>
                <label>
                    <span>Direccion:</span>
                    <input id="direccion" type="text" value="" require="" placeholder="" />
                    <input id="lat" type="hidden" value="" require="" placeholder="" />
                    <input id="lng" type="hidden" value="" require="" placeholder="" />
                    <div class="mensaje"></div>
                </label>
                <div id="map" style="width:100%; height:400px;"></div>
                <label>
                    <input type="button" onclick="fm(this)" value="Enviar">
                </label>
            </fieldset>
        </form>
    </div>
</div>

{{if .Lista}}
<div class="i">
    <div class="fc" id="info-0">
        <div class="fct">
            <h1>{{.SubTitulo}}</h1>
            <h2>{{.SubTitulo2}}</h2>
            <ul class="clearfix valign">
                <li class="back" onclick="backurl()"></li>
                <li class="back" onclick="backurl()"></li>
            </ul>
        </div>
        <ul class='lu'>
            {{range .Lista}}
            <li class="u" rel="{{.Id}}">                
                <div class="no">{{.Nombre}}</div>
                <div class="btns clearfix valign">
                    <a title="Eliminar" class="icn del" onclick="eliminar('{{$.DelAccion}}', {{.Id}}, '{{$.DelObj}}', '{{.Nombre}}')"></a>
                    <a title="Modificar" class="icn mod" onclick="navlink('{{$.PageMod}}?id={{.Id}}')"></a>
                    <a title="Modificar" class="icn ent" onclick="navlink('/pages/inicioEmpresa?id={{.Id}}')"></a>
                </div>
            </li>
            {{end}}
        </ul>
    </div>
</div>
{{end}}
<br />
<br />
<div id="infowindow-content">
    <img src="" width="16" height="16" id="place-icon" />
    <span id="place-name" class="title"></span><br />
    <span id="place-address"></span>
</div>